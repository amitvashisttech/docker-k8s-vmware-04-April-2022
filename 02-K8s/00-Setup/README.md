# In the following demo will be setting up 3 Node Kubernetes Cluster ( 1 Master & 2 Workers ) 

## For this demo will be required to have following tools installed. 
1.	Virtual Box
2.	Vagrant 
3.	Cmder / Git Bash 


## Now provision three virtual machines with following commands:

```
cd devops-lab/vagrant-setup/devops/
vagrant.exe up
```

```
vagrant.exe status
Current machine states:

master                    running (virtualbox)
worker1                   running (virtualbox)
worker2                   running (virtualbox)
```

## Login to master node & clone the repo after that execute install-master.sh. 

Note : 

1.	Check your master machines ip address & update the same in install-master.sh (--apiserver-advertise-address="YourMasterIP")
2.	Please copy the joining token which is generated by the execution script. 

```
vagrant.exe ssh master
sudo su - 
git clone https://github.com/amitvashisttech/docker-k8s-vmware-04-April-2022.git
cd docker-k8s-vmware-04-April-2022/02-K8s/00-Setup
sh install-master.sh

---
Your Kubernetes master has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

You can now join any number of machines by running the following on each node
as root:

  kubeadm join 172.31.0.100:6443 --token mr74fn.m4upjko4cfm5uwmz --discovery-token-ca-cert-hash sha256:cb406434a7f06d213eabfce7d6980b3948525d13e1c25b9f061831039bf49f52

---
```
## In order to intract with kubernetes cluster run the following commands
```
root@master:~# mkdir -p $HOME/.kube
root@master:~# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
root@master:~# sudo chown $(id -u):$(id -g) $HOME/.kube/config
root@k8s-master:~# kubectl get nodes 
NAME         STATUS   ROLES    AGE    VERSION
k8s-master   Ready    master   5m6s   v1.18.0
```


## In parallel Login to both the nodes /workers & clone the repo after that execute install-node.sh. 

```
vagrant.exe ssh woker1
sudo su - 
git clone https://github.com/amitvashisttech/docker-k8s-vmware-04-April-2022.git
cd docker-k8s-vmware-04-April-2022/02-K8s/00-Setup
sh install-worker.sh
```

## Now apply the joining token on both the workers
```
kubeadm join 172.31.0.100:6443 --token mr74fn.m4upjko4cfm5uwmz --discovery-token-ca-cert-hash sha256:cb406434a7f06d213eabfce7d6980b3948525d13e1c25b9f061831039bf49f52
```

## Let check the kubernetes cluster nodes status & details
```
root@master:~# kubectl get nodes -o wide
NAME      STATUS   ROLES                  AGE     VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
master    Ready    control-plane,master   14m     v1.21.0   172.31.0.100   <none>        Ubuntu 16.04.7 LTS   4.4.0-210-generic   docker://17.3.3
worker1   Ready    <none>                 4m27s   v1.21.0   172.31.0.101   <none>        Ubuntu 16.04.7 LTS   4.4.0-210-generic   docker://17.3.3
worker2   Ready    <none>                 3m12s   v1.21.0   172.31.0.102   <none>        Ubuntu 16.04.7 LTS   4.4.0-210-generic   docker://17.3.3
root@master:~#

```





